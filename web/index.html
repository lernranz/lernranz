<html>
    <head>
        <meta charset="UTF-8">
        <title>LERNRaumANZeiger</title>
        <script src="js/jquery.js"></script>
        <script src="js/d3.min.js"></script>
        <script src="js/epoch.min.js"></script>
        <script src="js/moment-with-locales.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="stylesheet" type="text/css" href="css/epoch.min.css">
        <style>
div.plot {
    width: 1000px;
    height: 300px;
}
h2 {
    display: inline;
    margin-right: 10px;
}
div.info {
    float: right;
}
span.notes {
    font-family: monospace;
    margin-left: 10px;
}
        </style>
        <script>
$(document).ready(function() {
    moment.locale('en', {
        calendar: {
            sameDay: '[Today] HH:mm',
            lastDay: 'ddd HH:mm',
            nextDay: '[Tomorrow] HH:mm',
            lastWeek: 'ddd HH:mm',
            nextWeek: '[next] ddd HH:mm',
            sameElse: 'L HH:mm'
        }
    });
    moment.locale('de', {
        calendar: {
            sameDay: '[heute] HH:mm',
            lastDay: 'ddd HH:mm',
            nextDay: '[morgen] HH:mm',
            lastWeek: 'ddd HH:mm',
            nextWeek: '[nächsten] ddd HH:mm',
            sameElse: 'L HH:mm'
        }
    });
    $.get('../rooms.json', function(spec) {
        roomsSpec = spec;
        $('body').append('<div id="content" ></div>');
        roomsSpec.forEach(function(room) {
            $('#content').append('<div class="room" id="'+ room.name +'" ></div>');
            $('#'+room.name).append('<h2>' + room.name + '</h2>');
            $('#'+room.name).append('<span id="current_users_' + room.id + '" class="current_users"/>');
            $('#'+room.name).append('<span id="notes_' + room.id + '" class="notes" />');
            $('#'+room.name).append(
                    '<div id="plot_' + room.id + '" style="width: 100%; height: 150px" class="epoch"/>');

            $.get('../parsed/' + room.id + '.json', function(roomData) {
                var firstValue = roomData[0].values[0];
                var lastValue = roomData[0].values[roomData[0].values.length - 1];
                $('#current_users_' + room.id).text(lastValue.y + ' WLAN-Nutzer (' + moment(lastValue.x).fromNow() + ')');
                if (room.notes != undefined) {
                    $('#notes_' + room.id).html(room.notes);
                }

                if (room.fullAt != undefined) {
                    room.state=lastValue.y/room.fullAt;
                    roomData.push({
                        label: 'max',
                        values: [{x: firstValue.x, y: room.fullAt}, {x: lastValue.x, y: room.fullAt}]
                    });
                }else{
                     room.state=0;
                }
                color="blue";
                $('#'+room.name).append('<h3 class="room_state">' + room.state+ '</h3>');
                if(room.state>0.75){color="red";}
                else if(room.state>0.5){color="yellow";}
                else if(room.state!=0){color="green";}
                document.getElementById('current_users_' + room.id).style.color = color;
                $('#plot_' + room.id).epoch({
                    type: 'line',
                    data: roomData,
                    ticks: {bottom: 7},
                    tickFormats: {bottom: function(d) { return moment(d).calendar(); }},
                    axes: ['left', 'bottom'],
                });
            });
        });
    });
});
        </script>
    <script>
    function srt(){
        var $divs = $("div.room");
        console.log($divs);
        var Ordered = $divs.sort(function (a, b) {
        aCon = $(a).find("h3").text();
        bCon = $(b).find("h3").text();
        if(aCon == "0")return  1;
        if(bCon == "0")return -1;
        return aCon > bCon;
    });
    $("#content").html(Ordered);
}
    </script>
    </head>
    <body>
        <div class="info">
            Kontakt: <a href="mailto:lernranz@lernranz.de">lernranz@lernranz.de</a><br/>
            <a href="about.html">über diese Seite / about</a>
        </div>
        <h1><a href=".">LERNRaumANZeiger</a></h1>
        <button onclick="srt()">Sort</button>
    </body>
</html>
